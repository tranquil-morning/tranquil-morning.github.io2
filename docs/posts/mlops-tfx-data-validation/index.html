<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jinwook Chang">
<meta name="dcterms.date" content="2023-06-22">

<title>Note of myself - MLOps TFX Data Validation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D7YERGZ04Y"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-D7YERGZ04Y', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Note of myself</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tranquil-morning" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tranquil-morning/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/zzang_jinuk/" rel="" target=""><i class="bi bi-instagram" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">MLOps TFX Data Validation</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">MLOps</div>
                <div class="quarto-category">MachineLearning</div>
                <div class="quarto-category">TFX</div>
                <div class="quarto-category">Script</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jinwook Chang </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 22, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">June 22, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>이번 자료에서는 <a href="https://cloud.google.com/solutions/machine-learning/analyzing-and-validating-data-at-scale-for-ml-using-tfx">TensorFlow Data Validation (TFDV)</a>의 사용법에 대해 알아볼 예정입니다. 이는 <a href="https://www.tensorflow.org/tfx">TensorFlow Extended (TFX)</a>라이브러리의 일부입니다.</p>
<p>TFDV는 대용량 ML 데이터를 이해하고 검증하고 모니터링하는 데에 사용됩니다. 이는 다음과 같은 정보를 제공해줄 수 있습니다.</p>
<ul>
<li><p>데이터의 통계량</p></li>
<li><p>Train 데이터의 요약</p></li>
<li><p>Train 데이터와 Test/Validation 데이터의 차이</p></li>
<li><p>비정상 데이터 검측 및 수정</p></li>
</ul>
<p>다음은 일반적인 TFDV의 워크플로우입니다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tfdv.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">picture of workflow</figcaption>
</figure>
</div>
<p>위에서 볼 수 있듯이 TFDV는 train 데이터의 통계량을 계산할 수 있고, 스키마를 만들 수 있습니다.<br>
이를 통해 새로운 데이터 셋이 스키마에 맞는지, 통계량이 어느정도 차이가 나는지 검증할 수 있습니다.</p>
<p>이 두가지를 TFDV를 통해 시현해보도록 하겠습니다.</p>
<section id="package-installation-and-imports" class="level2">
<h2 class="anchored" data-anchor-id="package-installation-and-imports">Package Installation and Imports</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow_data_validation <span class="im">as</span> tfdv</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> util <span class="im">import</span> add_extra_rows</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow_metadata.proto.v0 <span class="im">import</span> schema_pb2</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'TFDV Version: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(tfdv.__version__))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Tensorflow Version: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(tf.__version__))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>TFDV Version: 1.3.0
Tensorflow Version: 2.6.0</code></pre>
</section>
<section id="download-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="download-the-dataset">Download the dataset</h2>
<p><a href="http://archive.ics.uci.edu/ml/datasets/Census+Income">Census Income Dataset</a>을 통하여, 한 개인이 연간 50,000 불 이상의 소득을 올리는지 아닌지에 대한 예측 모델을 만들어 보겠습니다. 데이터의 attribute는 다음과 같습니다.</p>
<ul>
<li><strong>age</strong>: continuous.</li>
<li><strong>workclass</strong>: Private, Self-emp-not-inc, Self-emp-inc, Federal-gov, Local-gov, State-gov, Without-pay, Never-worked.</li>
<li><strong>fnlwgt</strong>: continuous.</li>
<li><strong>education</strong>: Bachelors, Some-college, 11th, HS-grad, Prof-school, Assoc-acdm, Assoc-voc, 9th, 7th-8th, 12th, Masters, 1st-4th, 10th, Doctorate, 5th-6th, Preschool.</li>
<li><strong>education-num</strong>: continuous.</li>
<li><strong>marital-status</strong>: Married-civ-spouse, Divorced, Never-married, Separated, Widowed, Married-spouse-absent, Married-AF-spouse.</li>
<li><strong>occupation</strong>: Tech-support, Craft-repair, Other-service, Sales, Exec-managerial, Prof-specialty, Handlers-cleaners, Machine-op-inspct, Adm-clerical, Farming-fishing, Transport-moving, Priv-house-serv, Protective-serv, Armed-Forces.</li>
<li><strong>relationship</strong>: Wife, Own-child, Husband, Not-in-family, Other-relative, Unmarried.</li>
<li><strong>race</strong>: White, Asian-Pac-Islander, Amer-Indian-Eskimo, Other, Black.</li>
<li><strong>sex</strong>: Female, Male.</li>
<li><strong>capital-gain</strong>: continuous.</li>
<li><strong>capital-loss</strong>: continuous.</li>
<li><strong>hours-per-week</strong>: continuous.</li>
<li><strong>native-country</strong>: United-States, Cambodia, England, Puerto-Rico, Canada, Germany, Outlying-US(Guam-USVI-etc), India, Japan, Greece, South, China, Cuba, Iran, Honduras, Philippines, Italy, Poland, Jamaica, Vietnam, Mexico, Portugal, Ireland, France, Dominican-Republic, Laos, Ecuador, Taiwan, Haiti, Columbia, Hungary, Guatemala, Nicaragua, Scotland, Thailand, Yugoslavia, El-Salvador, Trinadad&amp;Tobago, Peru, Hong, Holand-Netherlands.</li>
</ul>
<p>데이터를 읽고 train/test로 나누어 보겠습니다.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the training and evaluation datasets</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/adult.data'</span>, skipinitialspace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset. Do not shuffle for this demo notebook.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>train_df, eval_df <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s see the first few columns of the train and eval sets.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the train set</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>train_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
age
</th>
<th>
workclass
</th>
<th>
fnlwgt
</th>
<th>
education
</th>
<th>
education-num
</th>
<th>
marital-status
</th>
<th>
occupation
</th>
<th>
relationship
</th>
<th>
race
</th>
<th>
sex
</th>
<th>
capital-gain
</th>
<th>
capital-loss
</th>
<th>
hours-per-week
</th>
<th>
native-country
</th>
<th>
label
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
39
</td>
<td>
State-gov
</td>
<td>
77516
</td>
<td>
Bachelors
</td>
<td>
13
</td>
<td>
Never-married
</td>
<td>
Adm-clerical
</td>
<td>
Not-in-family
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
2174
</td>
<td>
0
</td>
<td>
40
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
1
</th>
<td>
50
</td>
<td>
Self-emp-not-inc
</td>
<td>
83311
</td>
<td>
Bachelors
</td>
<td>
13
</td>
<td>
Married-civ-spouse
</td>
<td>
Exec-managerial
</td>
<td>
Husband
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
13
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
2
</th>
<td>
38
</td>
<td>
Private
</td>
<td>
215646
</td>
<td>
HS-grad
</td>
<td>
9
</td>
<td>
Divorced
</td>
<td>
Handlers-cleaners
</td>
<td>
Not-in-family
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
3
</th>
<td>
53
</td>
<td>
Private
</td>
<td>
234721
</td>
<td>
11th
</td>
<td>
7
</td>
<td>
Married-civ-spouse
</td>
<td>
Handlers-cleaners
</td>
<td>
Husband
</td>
<td>
Black
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
4
</th>
<td>
28
</td>
<td>
Private
</td>
<td>
338409
</td>
<td>
Bachelors
</td>
<td>
13
</td>
<td>
Married-civ-spouse
</td>
<td>
Prof-specialty
</td>
<td>
Wife
</td>
<td>
Black
</td>
<td>
Female
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
Cuba
</td>
<td>
&lt;=50K
</td>
</tr>
</tbody>

</table>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the eval set</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>eval_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
age
</th>
<th>
workclass
</th>
<th>
fnlwgt
</th>
<th>
education
</th>
<th>
education-num
</th>
<th>
marital-status
</th>
<th>
occupation
</th>
<th>
relationship
</th>
<th>
race
</th>
<th>
sex
</th>
<th>
capital-gain
</th>
<th>
capital-loss
</th>
<th>
hours-per-week
</th>
<th>
native-country
</th>
<th>
label
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
26048
</th>
<td>
30
</td>
<td>
Private
</td>
<td>
270886
</td>
<td>
Some-college
</td>
<td>
10
</td>
<td>
Never-married
</td>
<td>
Other-service
</td>
<td>
Own-child
</td>
<td>
White
</td>
<td>
Female
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
26049
</th>
<td>
21
</td>
<td>
Private
</td>
<td>
216129
</td>
<td>
HS-grad
</td>
<td>
9
</td>
<td>
Never-married
</td>
<td>
Other-service
</td>
<td>
Own-child
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
35
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
26050
</th>
<td>
33
</td>
<td>
Private
</td>
<td>
189368
</td>
<td>
Some-college
</td>
<td>
10
</td>
<td>
Married-civ-spouse
</td>
<td>
Transport-moving
</td>
<td>
Husband
</td>
<td>
Black
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
United-States
</td>
<td>
&gt;50K
</td>
</tr>
<tr>
<th>
26051
</th>
<td>
19
</td>
<td>
?
</td>
<td>
141418
</td>
<td>
Some-college
</td>
<td>
10
</td>
<td>
Never-married
</td>
<td>
?
</td>
<td>
Own-child
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
15
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
26052
</th>
<td>
19
</td>
<td>
Private
</td>
<td>
306225
</td>
<td>
HS-grad
</td>
<td>
9
</td>
<td>
Never-married
</td>
<td>
Handlers-cleaners
</td>
<td>
Own-child
</td>
<td>
White
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
25
</td>
<td>
United-States
</td>
<td>
&lt;=50K
</td>
</tr>
</tbody>

</table>
</div>
<p>몇 개의 데이터로 데이터의 첫인상을 파악할 수 있습니다. 대부분 문자열과 정수인 것을 알 수 있습니다. 대부분 0인 열도 있습니다. 다음 섹션에서는 이 정보를 더 쉽게 검사할 수 있도록 TFDV를 사용하여 이 정보를 집계하고 처리하는 방법을 살펴보겠습니다.</p>
<section id="adding-extra-rows-with-anomalies" class="level3">
<h3 class="anchored" data-anchor-id="adding-extra-rows-with-anomalies">Adding extra rows with Anomalies</h3>
<p>나중에 TFDV가 어떻게 이상 값를 감지하는지 보여드리기 위해, 평가 데이터 세트에 몇 개의 행을 추가하겠습니다. 이 행들은 비정상적인 값으로 나중에 특정 알람을 트리거할 값을 가지고 있습니다. 이러한 행을 추가하는 코드는 <code>util.py</code>의 <code>add_extra_rows()</code> 함수에서 볼 수 있습니다.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add extra rows</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>eval_df <span class="op">=</span> add_extra_rows(eval_df)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># preview the added rows</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>eval_df.tail(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
age
</th>
<th>
workclass
</th>
<th>
fnlwgt
</th>
<th>
education
</th>
<th>
education-num
</th>
<th>
marital-status
</th>
<th>
occupation
</th>
<th>
relationship
</th>
<th>
race
</th>
<th>
sex
</th>
<th>
capital-gain
</th>
<th>
capital-loss
</th>
<th>
hours-per-week
</th>
<th>
native-country
</th>
<th>
label
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
6513
</th>
<td>
46
</td>
<td>
NaN
</td>
<td>
257473
</td>
<td>
Bachelors
</td>
<td>
8
</td>
<td>
Married-civ-spouse
</td>
<td>
Plumber
</td>
<td>
Husband
</td>
<td>
Other
</td>
<td>
Male
</td>
<td>
1000
</td>
<td>
0
</td>
<td>
41
</td>
<td>
Australia
</td>
<td>
&gt;50K
</td>
</tr>
<tr>
<th>
6514
</th>
<td>
0
</td>
<td>
Private
</td>
<td>
257473
</td>
<td>
Masters
</td>
<td>
8
</td>
<td>
Married-civ-spouse
</td>
<td>
Adm-clerical
</td>
<td>
Wife
</td>
<td>
Asian
</td>
<td>
Female
</td>
<td>
0
</td>
<td>
0
</td>
<td>
40
</td>
<td>
Pakistan
</td>
<td>
&gt;50K
</td>
</tr>
<tr>
<th>
6515
</th>
<td>
1000
</td>
<td>
Private
</td>
<td>
257473
</td>
<td>
Masters
</td>
<td>
8
</td>
<td>
Married-civ-spouse
</td>
<td>
Prof-specialty
</td>
<td>
Husband
</td>
<td>
Black
</td>
<td>
Male
</td>
<td>
0
</td>
<td>
0
</td>
<td>
20
</td>
<td>
Cameroon
</td>
<td>
&lt;=50K
</td>
</tr>
<tr>
<th>
6516
</th>
<td>
25
</td>
<td>
?
</td>
<td>
257473
</td>
<td>
Masters
</td>
<td>
8
</td>
<td>
Married-civ-spouse
</td>
<td>
gamer
</td>
<td>
Husband
</td>
<td>
Asian
</td>
<td>
Female
</td>
<td>
0
</td>
<td>
0
</td>
<td>
50
</td>
<td>
Mongolia
</td>
<td>
&lt;=50K
</td>
</tr>
</tbody>

</table>
</div>
</section>
</section>
<section id="generate-and-visualize-training-dataset-statistics" class="level2">
<h2 class="anchored" data-anchor-id="generate-and-visualize-training-dataset-statistics">Generate and visualize training dataset statistics</h2>
<p>이제 train 데이터의 통계량을 계산하고, 데이터를 시각화해봅시다. TFDV는 tensorflow의 TFRecord, pandas의 Dataframe, 그리고 csv 파일을 수용할 수 있습니다. 이번 자료에서는 pandas를 이용할 것입니다.</p>
<p>데이터의 통계량은 <a href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/generate_statistics_from_dataframe"><code>generate_statistics_from_dataframe()</code></a>를 사용하여 구할 수 있습니다. 이는 <a href="https://beam.apache.org/">Apache Beam</a>을 사용하여 대용량 데이터에서도 통계량을 구할 수 있도록 합니다.</p>
<p>Numeric Data와 Category Data는 하기와 같이 정리됩니다 :</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Numerical Data</th>
<th style="text-align: center;">Categorical Data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Count of data records</td>
<td style="text-align: center;">Count of data records</td>
</tr>
<tr class="even">
<td style="text-align: center;">% of missing data records</td>
<td style="text-align: center;">% of missing data records</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mean, std, min, max</td>
<td style="text-align: center;">unique records</td>
</tr>
<tr class="even">
<td style="text-align: center;">% of zero values</td>
<td style="text-align: center;">Avg string length</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate training dataset statistics</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>train_stats <span class="op">=</span> tfdv.generate_statistics_from_dataframe(train_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>통계량이 계산된 이후, <a href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/visualize_statistics"><code>visualize_statistics()</code></a>을 사용하여 이를 시각화 할 수 있습니다. 이것은 <a href="https://pair-code.github.io/facets/">Facets interface</a>를 보여주며, 누락된 데이터가 많거나 표준편차가 높은 경우 이를 파악하는 데 매우 유용합니다. 아래 셀을 실행하고 출력 인터페이스에서 다양한 설정(예: 정렬 기준, 역순, 특징 검색)을 탐색해 보세요.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize training dataset statistics</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tfdv.visualize_statistics(train_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="visualize-1.png" class="img-fluid"></p>
</section>
<section id="infer-data-schema" class="level2">
<h2 class="anchored" data-anchor-id="infer-data-schema">Infer data schema</h2>
<p>Next step is to create a data schema to describe your train set. Simply put, a schema describes standard characteristics of your data such as column data types and expected data value range. The schema is created on a dataset that you consider as reference, and can be reused to validate other incoming datasets.</p>
<p>다음 단계는 train 데이터를 설명하는 데이터 스키마를 만드는 것입니다. 스키마는 열 데이터 유형 및 데이터 값 범위와 같은 데이터의 표준 특성을 뜻합니다. 통계량이 계산과 같이, TFDV는 <a href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/infer_schema"><code>infer_schema()</code></a>를 통해 자동으로 스키마를 만들 수 있습니다. 이 메서드는 <a href="https://developers.google.com/protocol-buffers">protocol buffer</a>라는 스키마를 리턴합니다.<br>
이 스키마는 다음을 포함합니다:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Infer schema from the computed statistics.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> tfdv.infer_schema(statistics<span class="op">=</span>train_stats)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the inferred schema</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>tfdv.display_schema(schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Type
</th>
<th>
Presence
</th>
<th>
Valency
</th>
<th>
Domain
</th>
</tr>
<tr>
<th>
Feature name
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
‘age’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘workclass’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘workclass’
</td>
</tr>
<tr>
<th>
‘fnlwgt’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘education’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘education’
</td>
</tr>
<tr>
<th>
‘education-num’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘marital-status’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘marital-status’
</td>
</tr>
<tr>
<th>
‘occupation’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘occupation’
</td>
</tr>
<tr>
<th>
‘relationship’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘relationship’
</td>
</tr>
<tr>
<th>
‘race’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘race’
</td>
</tr>
<tr>
<th>
‘sex’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘sex’
</td>
</tr>
<tr>
<th>
‘capital-gain’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘capital-loss’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘hours-per-week’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘native-country’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘native-country’
</td>
</tr>
<tr>
<th>
‘label’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘label’
</td>
</tr>
</tbody>

</table>
</div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Values
</th>
</tr>
<tr>
<th>
Domain
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
‘workclass’
</th>
<td>
‘?’, ‘Federal-gov’, ‘Local-gov’, ‘Never-worked’, ‘Private’, ‘Self-emp-inc’, ‘Self-emp-not-inc’, ‘State-gov’, ‘Without-pay’
</td>
</tr>
<tr>
<th>
‘education’
</th>
<td>
‘10th’, ‘11th’, ‘12th’, ‘1st-4th’, ‘5th-6th’, ‘7th-8th’, ‘9th’, ‘Assoc-acdm’, ‘Assoc-voc’, ‘Bachelors’, ‘Doctorate’, ‘HS-grad’, ‘Masters’, ‘Preschool’, ‘Prof-school’, ‘Some-college’
</td>
</tr>
<tr>
<th>
‘marital-status’
</th>
<td>
‘Divorced’, ‘Married-AF-spouse’, ‘Married-civ-spouse’, ‘Married-spouse-absent’, ‘Never-married’, ‘Separated’, ‘Widowed’
</td>
</tr>
<tr>
<th>
‘occupation’
</th>
<td>
‘?’, ‘Adm-clerical’, ‘Armed-Forces’, ‘Craft-repair’, ‘Exec-managerial’, ‘Farming-fishing’, ‘Handlers-cleaners’, ‘Machine-op-inspct’, ‘Other-service’, ‘Priv-house-serv’, ‘Prof-specialty’, ‘Protective-serv’, ‘Sales’, ‘Tech-support’, ‘Transport-moving’
</td>
</tr>
<tr>
<th>
‘relationship’
</th>
<td>
‘Husband’, ‘Not-in-family’, ‘Other-relative’, ‘Own-child’, ‘Unmarried’, ‘Wife’
</td>
</tr>
<tr>
<th>
‘race’
</th>
<td>
‘Amer-Indian-Eskimo’, ‘Asian-Pac-Islander’, ‘Black’, ‘Other’, ‘White’
</td>
</tr>
<tr>
<th>
‘sex’
</th>
<td>
‘Female’, ‘Male’
</td>
</tr>
<tr>
<th>
‘native-country’
</th>
<td>
‘?’, ‘Cambodia’, ‘Canada’, ‘China’, ‘Columbia’, ‘Cuba’, ‘Dominican-Republic’, ‘Ecuador’, ‘El-Salvador’, ‘England’, ‘France’, ‘Germany’, ‘Greece’, ‘Guatemala’, ‘Haiti’, ‘Holand-Netherlands’, ‘Honduras’, ‘Hong’, ‘Hungary’, ‘India’, ‘Iran’, ‘Ireland’, ‘Italy’, ‘Jamaica’, ‘Japan’, ‘Laos’, ‘Mexico’, ‘Nicaragua’, ‘Outlying-US(Guam-USVI-etc)’, ‘Peru’, ‘Philippines’, ‘Poland’, ‘Portugal’, ‘Puerto-Rico’, ‘Scotland’, ‘South’, ‘Taiwan’, ‘Thailand’, ‘Trinadad&amp;Tobago’, ‘United-States’, ‘Vietnam’, ‘Yugoslavia’
</td>
</tr>
<tr>
<th>
‘label’
</th>
<td>
‘&lt;=50K’, ‘&gt;50K’
</td>
</tr>
</tbody>

</table>
</div>
</section>
<section id="generate-and-visualize-evaluation-dataset-statistics" class="level2">
<h2 class="anchored" data-anchor-id="generate-and-visualize-evaluation-dataset-statistics">Generate and visualize evaluation dataset statistics</h2>
<p>스키마를 생성한 다음 단계는 이제 validation 데이터 세트를 살펴보는 것입니다. 먼저 통계량를 계산한 다음 train 데이터의 통계량과 비교합니다. validation 데이터의 numeric 및 category 데이터의 특징이 train 데이터와 거의 일치하는 것이 중요합니다. 그렇지 않으면 분포 왜곡이 발생하여 모델의 정확도에 부정적인 영향을 미칠 수 있습니다.</p>
<p>TFDV는 <a href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/visualize_statistics"><code>visualize_statistics()</code></a>를 사용하여 train 데이터와 validation 데이터의 통계량을 각각 구할 수 있도록 합니다. <code>lhs</code>와 <code>rhs</code> 파라미터가 이를 가능케 합니다.</p>
<ul>
<li><p><code>lhs_statistics</code>: Required parameter. Expects an instance of <code>DatasetFeatureStatisticsList</code>.</p></li>
<li><p><code>rhs_statistics</code>: Expects an instance of <code>DatasetFeatureStatisticsList</code> to compare with <code>lhs_statistics</code>.</p></li>
<li><p><code>lhs_name</code>: Name of the <code>lhs_statistics</code> dataset.</p></li>
<li><p><code>rhs_name</code>: Name of the <code>rhs_statistics</code> dataset.</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate evaluation dataset statistics</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>eval_stats <span class="op">=</span> tfdv.generate_statistics_from_dataframe(eval_df)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare training with evaluation</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>tfdv.visualize_statistics(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    lhs_statistics<span class="op">=</span>eval_stats, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    rhs_statistics<span class="op">=</span>train_stats, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    lhs_name<span class="op">=</span><span class="st">'EVAL_DATASET'</span>, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    rhs_name<span class="op">=</span><span class="st">'TRAIN_DATASET'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="visualize-2.png" class="img-fluid"></p>
<p>생성된 결과를 관찰하고 메뉴를 전환하여 비주얼리제이션을 조작하는 연습(예: 누락/0을 기준으로 정렬)을 해 보시기 바랍니다. 앞서 소개한 잘못된 행을 TFDV가 감지하는 것을 알 수 있습니다. 먼저, <code>age</code> 의 <code>min</code> 및 <code>max</code> 값은 각각 <code>0</code> 및 <code>1000</code>으로 표시됩니다. 이 값은 일하는 성인에 대해 이야기하는 경우 의미가 없다는 것을 알고 있습니다. 둘째, 범주형 특징의 <code>workclass</code>는 데이터의 <code>0.02%</code>가 누락되어 있다고 말합니다. 이 행을 삭제하여 데이터를 더 깔끔하게 만들겠습니다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the age range</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>eval_df <span class="op">=</span> eval_df[eval_df[<span class="st">'age'</span>] <span class="op">&gt;</span> <span class="dv">16</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>eval_df <span class="op">=</span> eval_df[eval_df[<span class="st">'age'</span>] <span class="op">&lt;</span> <span class="dv">91</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing values</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>eval_df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can then compute the statistics again and see the difference in the results.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate evaluation dataset statistics</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>eval_stats <span class="op">=</span> tfdv.generate_statistics_from_dataframe(eval_df)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare training with evaluation</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>tfdv.visualize_statistics(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    lhs_statistics<span class="op">=</span>eval_stats, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    rhs_statistics<span class="op">=</span>train_stats, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    lhs_name<span class="op">=</span><span class="st">'EVAL_DATASET'</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    rhs_name<span class="op">=</span><span class="st">'TRAIN_DATASET'</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="visualize-3.png" class="img-fluid"></p>
</section>
<section id="calculate-and-display-evaluation-anomalies" class="level2">
<h2 class="anchored" data-anchor-id="calculate-and-display-evaluation-anomalies">Calculate and display evaluation anomalies</h2>
<p>스키마를 사용하여 validation 데이터에서 이상 징후를 확인할 수 있습니다. 감지된 이상값은 정리해야 하는 실제 오류로 간주될 수도 있고, 도메인 지식과 특정 사례에 따라 허용될 수도 있습니다.</p>
<p>이상 징후를 감지하여 표시하고 해결해야 할 문제가 있는지 확인해 보겠습니다.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check evaluation data for errors by validating the evaluation dataset statistics using the reference schema</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>anomalies <span class="op">=</span>  tfdv.validate_statistics(statistics<span class="op">=</span>eval_stats, schema<span class="op">=</span>schema)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize anomalies</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>tfdv.display_anomalies(anomalies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Anomaly short description
</th>
<th>
Anomaly long description
</th>
</tr>
<tr>
<th>
Feature name
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
‘race’
</th>
<td>
Unexpected string values
</td>
<td>
Examples contain values missing from the schema: Asian (&lt;1%).
</td>
</tr>
<tr>
<th>
‘occupation’
</th>
<td>
Unexpected string values
</td>
<td>
Examples contain values missing from the schema: gamer (&lt;1%).
</td>
</tr>
<tr>
<th>
‘native-country’
</th>
<td>
Unexpected string values
</td>
<td>
Examples contain values missing from the schema: Mongolia (&lt;1%).
</td>
</tr>
</tbody>

</table>
</div>
</section>
<section id="revising-the-schema" class="level2">
<h2 class="anchored" data-anchor-id="revising-the-schema">Revising the Schema</h2>
<p>위의 결과에서 볼 수 있듯이 TFDV는 앞서 소개한 나머지 불규칙성을 탐지할 수 있습니다. 짧고 긴 설명을 통해 무엇이 탐지되었는지 알 수 있습니다. 예상대로, 훈련 세트 스키마의 도메인에서 찾을 수 없는 <code>race</code>, <code>native-country</code>, <code>occupation</code>에 대한 문자열 값이 있습니다. 이상값에 대해 어떻게 처리할지는 데이터에 대한 도메인 지식에 따라 달라집니다. 이상 현상이 데이터 오류를 나타내는 경우 기초 데이터를 수정해야 합니다. 그렇지 않으면 평가 데이터 집합에 값을 포함하도록 스키마를 업데이트할 수 있습니다.</p>
<p>TFDV는 스키마를 수정하기 위한 메서드 역시 제공합니다. 이 <a href="https://www.tensorflow.org/tfx/data_validation/anomalies">레퍼런스</a> 는 이상치의 종류와 이를 수정하기 위한 문서입니다. 이 자료에서는 주요한 몇가지에 대해서만 시연해보겠습니다.</p>
<p>특정 열에서 특정 값이 만족해야하는 비율을 조정할 수 있습니다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tfdv.get_feature(schema, <span class="st">'feature_column_name'</span>).distribution_constraints.min_domain_mass <span class="op">=</span> <span class="op">&lt;</span><span class="bu">float</span>: <span class="fl">0.0</span> to <span class="fl">1.0</span><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>특정 열에 새로운 특정 값을 추가할 수 있습니다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tfdv.get_domain(schema, <span class="st">'feature_column_name'</span>).value.append(<span class="st">'string'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fix-anomalies-in-the-schema" class="level2">
<h2 class="anchored" data-anchor-id="fix-anomalies-in-the-schema">Fix anomalies in the schema</h2>
<p>보고된 문자열 이상값을 유효한 것으로 받아들이고 싶다고 가정해 보겠습니다. 평가 데이터 세트에서 일부 누락된 값을 허용하려면 다음과 같이 하면 됩니다:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relax the minimum fraction of values that must come from the domain for the feature `native-country`</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>country_feature <span class="op">=</span> tfdv.get_feature(schema, <span class="st">'native-country'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>country_feature.distribution_constraints.min_domain_mass <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Relax the minimum fraction of values that must come from the domain for the feature `occupation`</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>occupation_feature <span class="op">=</span> tfdv.get_feature(schema, <span class="st">'occupation'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>occupation_feature.distribution_constraints.min_domain_mass <span class="op">=</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>도메인에 유효한 값만 추가하는 대신 엄격하게 하려면 다음과 같이 하면 됩니다:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new value to the domain of the feature `race`</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>race_domain <span class="op">=</span> tfdv.get_domain(schema, <span class="st">'race'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>race_domain.value.append(<span class="st">'Asian'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>또한 숫자 기능의 범위를 제한할 수도 있습니다. 이렇게 하면 육안으로 검사하지 않고도 유효하지 않은 값을 알 수 있습니다(예: 앞서 유효하지 않은 <code>age</code> 값).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict the range of the `age` feature</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tfdv.set_domain(schema, <span class="st">'age'</span>, schema_pb2.IntDomain(name<span class="op">=</span><span class="st">'age'</span>, <span class="bu">min</span><span class="op">=</span><span class="dv">17</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the modified schema. Notice the `Domain` column of `age`.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>tfdv.display_schema(schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Type
</th>
<th>
Presence
</th>
<th>
Valency
</th>
<th>
Domain
</th>
</tr>
<tr>
<th>
Feature name
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
‘age’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
min: 17; max: 90
</td>
</tr>
<tr>
<th>
‘workclass’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘workclass’
</td>
</tr>
<tr>
<th>
‘fnlwgt’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘education’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘education’
</td>
</tr>
<tr>
<th>
‘education-num’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘marital-status’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘marital-status’
</td>
</tr>
<tr>
<th>
‘occupation’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘occupation’
</td>
</tr>
<tr>
<th>
‘relationship’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘relationship’
</td>
</tr>
<tr>
<th>
‘race’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘race’
</td>
</tr>
<tr>
<th>
‘sex’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘sex’
</td>
</tr>
<tr>
<th>
‘capital-gain’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘capital-loss’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘hours-per-week’
</th>
<td>
INT
</td>
<td>
required
</td>
<td>
</td>
<td>
-
</td>
</tr>
<tr>
<th>
‘native-country’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘native-country’
</td>
</tr>
<tr>
<th>
‘label’
</th>
<td>
STRING
</td>
<td>
required
</td>
<td>
</td>
<td>
‘label’
</td>
</tr>
</tbody>

</table>
</div>
<div>


<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Values
</th>
</tr>
<tr>
<th>
Domain
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
‘workclass’
</th>
<td>
‘?’, ‘Federal-gov’, ‘Local-gov’, ‘Never-worked’, ‘Private’, ‘Self-emp-inc’, ‘Self-emp-not-inc’, ‘State-gov’, ‘Without-pay’
</td>
</tr>
<tr>
<th>
‘education’
</th>
<td>
‘10th’, ‘11th’, ‘12th’, ‘1st-4th’, ‘5th-6th’, ‘7th-8th’, ‘9th’, ‘Assoc-acdm’, ‘Assoc-voc’, ‘Bachelors’, ‘Doctorate’, ‘HS-grad’, ‘Masters’, ‘Preschool’, ‘Prof-school’, ‘Some-college’
</td>
</tr>
<tr>
<th>
‘marital-status’
</th>
<td>
‘Divorced’, ‘Married-AF-spouse’, ‘Married-civ-spouse’, ‘Married-spouse-absent’, ‘Never-married’, ‘Separated’, ‘Widowed’
</td>
</tr>
<tr>
<th>
‘occupation’
</th>
<td>
‘?’, ‘Adm-clerical’, ‘Armed-Forces’, ‘Craft-repair’, ‘Exec-managerial’, ‘Farming-fishing’, ‘Handlers-cleaners’, ‘Machine-op-inspct’, ‘Other-service’, ‘Priv-house-serv’, ‘Prof-specialty’, ‘Protective-serv’, ‘Sales’, ‘Tech-support’, ‘Transport-moving’
</td>
</tr>
<tr>
<th>
‘relationship’
</th>
<td>
‘Husband’, ‘Not-in-family’, ‘Other-relative’, ‘Own-child’, ‘Unmarried’, ‘Wife’
</td>
</tr>
<tr>
<th>
‘race’
</th>
<td>
‘Amer-Indian-Eskimo’, ‘Asian-Pac-Islander’, ‘Black’, ‘Other’, ‘White’, ‘Asian’
</td>
</tr>
<tr>
<th>
‘sex’
</th>
<td>
‘Female’, ‘Male’
</td>
</tr>
<tr>
<th>
‘native-country’
</th>
<td>
‘?’, ‘Cambodia’, ‘Canada’, ‘China’, ‘Columbia’, ‘Cuba’, ‘Dominican-Republic’, ‘Ecuador’, ‘El-Salvador’, ‘England’, ‘France’, ‘Germany’, ‘Greece’, ‘Guatemala’, ‘Haiti’, ‘Holand-Netherlands’, ‘Honduras’, ‘Hong’, ‘Hungary’, ‘India’, ‘Iran’, ‘Ireland’, ‘Italy’, ‘Jamaica’, ‘Japan’, ‘Laos’, ‘Mexico’, ‘Nicaragua’, ‘Outlying-US(Guam-USVI-etc)’, ‘Peru’, ‘Philippines’, ‘Poland’, ‘Portugal’, ‘Puerto-Rico’, ‘Scotland’, ‘South’, ‘Taiwan’, ‘Thailand’, ‘Trinadad&amp;Tobago’, ‘United-States’, ‘Vietnam’, ‘Yugoslavia’
</td>
</tr>
<tr>
<th>
‘label’
</th>
<td>
‘&lt;=50K’, ‘&gt;50K’
</td>
</tr>
</tbody>

</table>
</div>
<p>이러한 수정 사항을 적용하면 이제 유효성 검사를 실행해도 이상 징후가 나타나지 않아야 합니다.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate eval stats after updating the schema </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>updated_anomalies <span class="op">=</span> tfdv.validate_statistics(eval_stats, schema)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>tfdv.display_anomalies(updated_anomalies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h4 style="color:green;" class="anchored">
No anomalies found.
</h4>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap up</h2>
<p>이 자료에서 머신 러닝 프로젝트에서 데이터 유효성 검사를 사용하는 방법을 보여드렸습니다.</p>
<ul>
<li><p>대용량 데이터 세트에 대한 통계 계산을 할 수 있습니다.</p></li>
<li><p>주어진 데이터 세트의 스키마를 추론하고 도메인 지식을 기반으로 수정할 수 있습니다.</p></li>
<li><p>통계를 시각화하고 이상 징후를 감지하여 학습 데이터 세트와 평가 데이터 세트 간의 불일치를 검사할 수 있습니다.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>